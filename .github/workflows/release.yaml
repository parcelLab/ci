name: Reusable Release Drafter
on:
  workflow_call:
    inputs:
      runner:
        required: false
        description: Runner type
        default: ubuntu-latest
        type: string
      configName:
        required: false
        description: The path within the .github/ folder for the release drafter configuration
        type: string
    secrets:
      REPO_ACCESS_TOKEN:
        required: true
        description: The Github token to perform operations cross-repo (not secrets.GITHUB_TOKEN!)
jobs:
  release:
    runs-on: ${{ inputs.runner }}
    steps:
      - name: Create Release Drafter config
        if: inputs.configName == ''
        run: |
          mkdir -p .github
          cat > .github/release-drafter.yml <<'EOF'
          template: |
            $CHANGES
          categories:
            - title: "🚀 Features"
              labels:
                - enhancement
            - title: "🐛 Bug Fixes"
              labels:
                - bug
            - title: "🧹 Chores"
              labels:
                - chore
          change-template: "- $TITLE (#$NUMBER) @$AUTHOR"
          no-changes-template: "* No changes"
          autolabeler:
            - label: enhancement
              title: '^feat:'
            - label: bug
              title: '^fix:'
            - label: chore
              title: '^chore:'
          EOF

      - name: Update Release Draft
        uses: release-drafter/release-drafter@v6
        with:
          config-name: ${{ inputs.configName || '.github/release-drafter.yml' }}
        env:
          GITHUB_TOKEN: ${{ secrets.REPO_ACCESS_TOKEN }}

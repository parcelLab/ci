name: Update Major Version Tag

on:
  release:
    types: [created]

jobs:
  update-major-tag:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Extract major version
        id: version
        run: |
          TAG_NAME="${{ github.event.release.tag_name }}"
          # Extract major version (e.g., v8.2.7 -> v8)
          MAJOR_VERSION=$(echo $TAG_NAME | sed -E 's/^v([0-9]+)\..*/v\1/')
          echo "major_version=$MAJOR_VERSION" >> $GITHUB_OUTPUT
          echo "full_version=$TAG_NAME" >> $GITHUB_OUTPUT
          
      - name: Update major version tag
        run: |
          git config user.name "parcellab-dev-bot"
          git config user.email "dev.bot@parcellab.com"
          
          # Delete existing major version tag if it exists
          echo git tag -d ${{ steps.version.outputs.major_version }} || true
          echo git push origin :refs/tags/${{ steps.version.outputs.major_version }} || true
          
          # Create new major version tag pointing to the same commit as the full version
          echo git tag ${{ steps.version.outputs.major_version }} ${{ github.event.release.tag_name }}
          echo git push origin ${{ steps.version.outputs.major_version }}
          